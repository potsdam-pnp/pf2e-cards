\documentclass[paper=63mm:88mm, DIV=21, fontsize=7.5pt]{scrartcl}
\usepackage{xcolor}
\usepackage{fontspec}
\usepackage{mathtools}
\usepackage{tikz}
\usepackage{unicode-math}
\usepackage{multicol}
\usepackage{xparse}

\usetikzlibrary{svg.path}
\usetikzlibrary{fit}
\usetikzlibrary{backgrounds}

\input{fonts.tex}

\begin{document}

\pagestyle{empty}

\input{symbols.tex}

\setlength\parindent{0pt} % todo: avoid in favor of some komascript feature
\setlength\parskip{4pt} % todo: avoid in favor of some komascript feature

\addtokomafont{section}{\clearpage\normalfont\postamt}
\addtokomafont{subsection}{\normalfont\mittelschrift}

\renewcommand*{\sectionformat}{}
\renewcommand*{\subsectionformat}{}

\newcommand{\Item}[2]{\section{#2 \hfill \color{gray} Item #1}}
\newcommand{\Spell}[2]{\section{#2 \hfill \color{gray} Spell #1}}
\newcommand{\Cantrip}[2]{\section{#2 \hfill \color{gray} Cantrip #1}}
\newcommand{\Action}[5][]{\subsection[#5]{#5\ActionSymbol{#4} \ifx&#1&\else{\normalsize\engschrift (#1)}\fi \hfill \Reference{#2}{#3}}}

\newcommand{\Requirements}[1]{\paragraph{Requirements} #1.}

\newcommand{\Attribute}[2]{\smallskip\mbox{\engschrift \color{gray} #1 \normalcolor #2}}
\newcommand{\WeaponDamage}[1]{\Attribute{Damage}{#1}}
\newcommand{\ItemHands}[1]{\Attribute{Hands}{#1}}
\newcommand{\ItemBulk}[1]{\Attribute{Bulk}{#1}}
\newcommand{\ItemPrice}[1]{\Attribute{Price}{#1}}
\newcommand{\WeaponType}[1]{\Attribute{Type}{#1}}
\newcommand{\WeaponCategory}[1]{\Attribute{Category}{#1}}
\newcommand{\WeaponGroup}[1]{\Attribute{Group}{#1}}
\newcommand{\Flavor}[1]{\textit{#1}}

\newcommand{\Reference}[2]{{\small \color{gray} \engschrift #1 #2}}

\newcommand{\Tag}[2]{%
    \tikz[baseline]{%
        \node[anchor=base, text=white, fill=#1, font=\sffamily, text depth=.5mm] {#2};
    }%
}

\definecolor{tagsBg}{RGB}{217, 196, 132}
\definecolor{uncommonBg}{RGB}{152, 81, 61}
\definecolor{rareBg}{RGB}{0, 38, 100}
\definecolor{traitBg}{RGB}{94, 0, 0}

\newcommand{\Trait}[1]{\Tag{traitBg}{#1}}
\newcommand{\Rare}[0]{\Tag{rareBg}{Rare}}
\newcommand{\Uncommon}[0]{\Tag{uncommonBg}{Uncommon}}

\newcommand{\Traits}[1]{\colorbox{tagsBg}{#1}}

\section{Symbol Reference}

\subsection{Actions\hfill\Reference{CRB}{17}}

\ActionSymbol{0} free action

\ActionSymbol{1} single action 

\ActionSymbol{2}, \ActionSymbol{3} activity using 2 or 3 actions

??? reaction

\subsection{Damage Types\hfill\Reference{CRB}{451}}

\begin{multicols}{3}
\footnotesize

\(\DamageType{Bludgeoning}\) bludgeoning

\(\DamageType{Slashing}\) slashing

\(\DamageType{Piercing}\) piercing

\(\DamageType{Cold}\) cold

\(\DamageType{Fire}\) fire

\(\DamageType{Acid}\) acid

\(\DamageType{Electricity}\) electricity

\(\DamageType{Sonic}\) sonic

\(\DamageType{Positive}\) positive

\(\DamageType{Negative}\) negative

\(\DamageType{Force}\) force

\(\DamageType{Chaotic}\) chaotic

\(\DamageType{Evil}\) evil

\(\DamageType{Good}\) good

\(\DamageType{Lawful}\) lawful

\(\DamageType{Poison}\) poison

\(\DamageType{Magic}\) magic

\(\DamageType{Mental}\) mental

\(\DamageType{Bleed}\) bleed

\end{multicols}

\section{Frightened}

You're gripped by fear and struggle to control your nerves.
The frightened condition always includes a value.
You take a status penalty equal to this value to all your checks and DCs.
Unless specified otherwise, at the end of each of your turns, the value of your frightened condition decreases by 1.

\Item{1}{Steel Shield}

% TODO: Make room for some flavor text? Or maybe not, because the text is not very flavorful anyway
% \Flavor{Steel shields come in a variety of shapes and sizes.}

Hardness 5
HP 20 (BT 10)

\Action{CRB}{472}{1}{Raise a Shield}

\Flavor{You position your shield to protect yourself.}

Gain \(+2\) circumstance bonus to AC until the start of your next turn.

\Action[attack]{CRB}{281}{1}{Shield Bash}

\Flavor{Thrust or swing your shield to hit your foe with an impromptu attack.}

\CheckRoll{MeleeAttack}{str, prof}
\DamageRoll{Bludgeoning}{1d4}{str}

\ItemPrice{2gp}
\ItemBulk{1}
\ItemHands{1}
\WeaponType{Melee}
\WeaponCategory{Martial}
\WeaponGroup{Shield}

\Item{3}{Smoking Sword}

\Traits{\Trait{Evocation} \Trait{Fire} \Trait{Magical}}

\Flavor{Smoke constantly belches from this magic longsword.}

\Action[attack]{CRB}{471}{1}{Strike}

\CheckRoll{MeeleAttack}{str, prof, 1}
\DamageRoll{Slashing}[Piercing]{1d8}{str}
\DamageRoll{Fire}{1}{}

\Action[concentrate]{BB:GMG}{51}{1}{Activate}

\Flavor{The blade's edges light on fire.}

Until the end of your turn, the blade deals 1d6 extra fire damage instead of just 1. After you use this action, you can't use it again for 10 minutes.

\vfill

\ItemPrice{60gp}
\ItemBulk{1}
\ItemHands{1}
\WeaponType{Melee}
\WeaponCategory{Martial}
\WeaponGroup{Sword}

\foreach[evaluate=\level as \bonus using int(\level*8)] \level in {1, ..., 10} {
\Spell{\level}{Heal}

\Traits{\Trait{Healing} \Trait{Necromancy} \Trait{Positive}}

% TODO make room for some flavor text?
% \Flavor{You channel positive energy.}

Restore \(\operatorname{\level d8}\) hit points to willing living creatures.\\
Deal \(\operatorname{\level d8}\) positive damage to undead creatures.\\
They get a basic Fortituate save.

\Action[somatic]{CRB}{343}{1}{Cast}

Target 1 creature within touch range.

\Action[somatic, verbal]{CRB}{343}{2}{Cast}

Target 1 creature within 30 feet.\\
You can restore \(\operatorname{\level d8}+\bonus\) instead of \(\operatorname{\level d8}\) hit points.

\Action[material, somatic, verbal]{CRB}{343}{3}{Cast}

\Flavor{Disperse positive energy in a 30-foot emanation.}

Target every creature within 30 feet.
}

\foreach[evaluate=\level as \bonus using int(\level*8)] \level in {1, ..., 10} {
\Cantrip{\level}{Ray of Frost}

\Traits{\Trait{Attack} \Trait{Cantrip} \Trait{Cold} \Trait{Evocation}}

\Flavor{You blast an icy ray.}

\Action[attack, somatic, verbal]{CRB}{362}{2}{Cast}

Target 1 creature within 120 feet with a spell atack.

\CheckRoll{SpellAttack}{int, prof}
\DamageRoll{Cold}{\level d4}{int}

On a critical success, the target takes double damage
and takes a \(-10\)-foot status penalty to its Speeds for 1 round.
}

\end{document}
