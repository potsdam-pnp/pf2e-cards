\documentclass[paper=63mm:88mm, DIV=21, fontsize=7.5pt]{scrartcl}
\usepackage{xcolor}
\usepackage{fontspec}
\usepackage{mathtools}
\usepackage{tikz}
\usepackage{unicode-math}
\usepackage{multicol}
\usepackage{xparse}

\usetikzlibrary{svg.path}
\usetikzlibrary{fit}
\usetikzlibrary{backgrounds}

\input{fonts.tex}

\begin{document}

\pagestyle{empty}

\input{symbols.tex}

\setlength\parindent{0pt} % todo: avoid in favor of some komascript feature
\setlength\parskip{4pt} % todo: avoid in favor of some komascript feature

\addtokomafont{section}{\clearpage\normalfont\postamt}
\addtokomafont{subsection}{\normalfont\mittelschrift}

\renewcommand*{\sectionformat}{}
\renewcommand*{\subsectionformat}{}

\newcommand{\Card}[3]{\section{#3 \hfill \color{gray} #1 #2}}

\newcommand{\Action}[5][]{\subsection[#5]{#5\ActionSymbol{#4} \ifx&#1&\else{\normalsize\engschrift (#1)}\fi \hfill \Reference{#2}{#3}}}

\newcommand{\Requirements}[1]{\paragraph{Requirements} #1.}

\newcommand{\Attribute}[2]{\smallskip\mbox{\engschrift \color{gray} #1 \normalcolor #2}}
\newcommand{\WeaponDamage}[1]{\Attribute{Damage}{#1}}
\newcommand{\ItemHands}[1]{\Attribute{Hands}{#1}}
\newcommand{\ItemBulk}[1]{\Attribute{Bulk}{#1}}
\newcommand{\ItemPrice}[1]{\Attribute{Price}{#1}}
\newcommand{\WeaponType}[1]{\Attribute{Type}{#1}}
\newcommand{\WeaponCategory}[1]{\Attribute{Category}{#1}}
\newcommand{\WeaponGroup}[1]{\Attribute{Group}{#1}}
\newcommand{\Flavor}[1]{\textit{#1}}

\newcommand{\Hardness}[1]{\Attribute{Hardness}{#1}}
% TODO: Render a box to enter current hit points
\newcommand{\HitPoints}[1]{\Attribute{HP}{#1}}
\newcommand{\BrokenThreshold}[1]{\Attribute{BT}{#1}}

\newcommand{\Reference}[2]{{\small \color{gray} \engschrift #1 #2}}

\newcommand{\Tag}[2]{%
    \tikz[baseline]{%
        \node[anchor=base, text=white, fill=#1, font=\sffamily, text depth=.5mm] {#2};
    }%
}

\definecolor{tagsBg}{RGB}{217, 196, 132}
\definecolor{uncommonBg}{RGB}{152, 81, 61}
\definecolor{rareBg}{RGB}{0, 38, 100}
\definecolor{traitBg}{RGB}{94, 0, 0}

\newcommand{\Trait}[1]{\Tag{traitBg}{#1}}
\newcommand{\Rare}[0]{\Tag{rareBg}{Rare}}
\newcommand{\Uncommon}[0]{\Tag{uncommonBg}{Uncommon}}

\newcommand{\Traits}[1]{\colorbox{tagsBg}{#1}}

\section{Symbol Reference}

\subsection{Actions\hfill\Reference{CRB}{17}}

\pfsymbol{free-action} free action

\pfsymbol{one-action} single action

\pfsymbol{two-actions} two actions

\pfsymbol{three-actions} three actions

\pfsymbol{reaction} reaction

\subsection{Degrees of Success\hfill\Reference{CRB}{445}}
\begin{multicols}{2}
\footnotesize
\pfsymbol{critical-success} critical success

\pfsymbol{success} success

\pfsymbol{failure} failure

\pfsymbol{critical-failure} critical failure
\end{multicols}

\section{Symbol Reference}
\subsection{Damage Types\hfill\Reference{CRB}{451}}

\begin{multicols}{3}
\footnotesize

\pfsymbol{bludgeoning} bludgeoning

\pfsymbol{slashing} slashing

\pfsymbol{piercing} piercing

\pfsymbol{cold} cold

\pfsymbol{fire} fire

\pfsymbol{acid} acid

\pfsymbol{electricity} electricity

\pfsymbol{sonic} sonic

\pfsymbol{positive} positive

\pfsymbol{negative} negative

\pfsymbol{force} force

\pfsymbol{chaotic} chaotic

\pfsymbol{evil} evil

\pfsymbol{good} good

\pfsymbol{lawful} lawful

\pfsymbol{poison} poison

\pfsymbol{magical} magic

\pfsymbol{mental} mental

\pfsymbol{bleeding} bleed

\end{multicols}

\section{Frightened}

You're gripped by fear and struggle to control your nerves.
The frightened condition always includes a value.
You take a status penalty equal to this value to all your checks and DCs.
Unless specified otherwise, at the end of each of your turns, the value of your frightened condition decreases by 1.

\Card{Item}{1}{Steel Shield}

\Flavor{Steel shields come in a variety of shapes and sizes.}

% TODO: How should we render these item stats?
\Hardness{5}
\HitPoints{20}
\BrokenThreshold{10}

\Action{CRB}{472}{1}{Raise a Shield}

\Flavor{You position your shield to protect yourself.}

Gain \(+2\) circumstance bonus to AC until the start of your next turn.

\Action[attack]{CRB}{281}{1}{Shield Bash}

\Flavor{Thrust or swing your shield to hit your foe with an impromptu attack.}

\CheckRoll{MeleeAttack}{str, prof}
\DamageRoll{Bludgeoning}{1d4}{str}

\ItemPrice{2gp}
\ItemBulk{1}
\ItemHands{1}
\WeaponType{Melee}
\WeaponCategory{Martial}
\WeaponGroup{Shield}

\Card{Item}{3}{Smoking Sword}

\Traits{\Trait{Evocation} \Trait{Fire} \Trait{Magical}}

\Flavor{Smoke constantly belches from this magic longsword.}

\Action[attack]{CRB}{471}{1}{Strike}

\CheckRoll{MeeleAttack}{str, prof, 1}
\DamageRoll{Slashing}[Piercing]{1d8}{str}
\DamageRoll{Fire}{1}{}

\Action[concentrate]{BB:GMG}{51}{1}{Activate}

\Flavor{The blade's edges light on fire.}

Until the end of your turn, the blade deals 1d6 extra fire damage instead of just 1. After you use this action, you can't use it again for 10 minutes.

\vfill

\ItemPrice{60gp}
\ItemBulk{1}
\ItemHands{1}
\WeaponType{Melee}
\WeaponCategory{Martial}
\WeaponGroup{Sword}

\foreach[evaluate=\level as \bonus using int(\level*8)] \level in {1, ..., 10} {
\Card{Spell}{\level}{Heal}

\Traits{\Trait{Healing} \Trait{Necromancy} \Trait{Positive}}

% TODO make room for some flavor text?
% \Flavor{You channel positive energy.}

Restore \(\operatorname{\level d8}\) hit points to willing living creatures.\\
Deal \(\operatorname{\level d8}\) positive damage to undead creatures.\\
They get a basic Fortituate save.

\Action[somatic]{CRB}{343}{1}{Cast}

Target 1 creature within touch range.

\Action[somatic, verbal]{CRB}{343}{2}{Cast}

Target 1 creature within 30 feet.\\
You can restore \(\operatorname{\level d8}+\bonus\) instead of \(\operatorname{\level d8}\) hit points.

\Action[material, somatic, verbal]{CRB}{343}{3}{Cast}

\Flavor{Disperse positive energy in a 30-foot emanation.}

Target every creature within 30 feet.
}

\foreach[evaluate=\level as \bonus using int(\level*8)] \level in {1, ..., 10} {
\Card{Cantrip}{\level}{Ray of Frost}

\Traits{\Trait{Attack} \Trait{Cantrip} \Trait{Cold} \Trait{Evocation}}

\Flavor{You blast an icy ray.}

\Action[attack, somatic, verbal]{CRB}{362}{2}{Cast}

Target 1 creature within 120 feet with a spell atack.

\CheckRoll{SpellAttack}{int, prof}
\DamageRoll{Cold}{\level d4}{int}

On a critical success, the target takes double damage
and takes a \(-10\)-foot status penalty to its Speeds for 1 round.
}

% Force Bolt
% https://2e.aonprd.com/Spells.aspx?ID=529

\foreach[evaluate=\level as \half using int(ceil(\level/2))] \level in {1, ..., 10} {
\Card{Focus}{\level}{Force Bolt}

\Traits{\Uncommon \Trait{Evocation} \Trait{Force} \Trait{Wizard}}

\Flavor{You fire an unerring dart of force from your fingertips. It automatically hits and deals force damage to the target}.

\Action[somatic]{CRB}{362}{1}{Cast}

Target 1 creature within 30 feet.

\DamageRoll{Force}{\half d4 + \half}{}
}

\Card{Action}{}{Demoralize}
\Traits{\Trait{Emotion} \Trait{Fear} \Trait{Mental}}


\Flavor{With a sudden shout, a well-timed taunt, or a cutting putdown, you can shake an enemy's resolve.}

Target a creature you're aware of within 30 feet.
The target becomes immune to your attempts to Demoralize it for 10 minutes.

% TODO figure out spacing
\vspace{-1em}

\Action[auditory, concentrate]{CRB}{247}{1}{Demoralize}

If you speak a language that the target understands.

\CheckRoll{Intimidation}{cha, prof}[Will DC]
\EffectBox{Frightened 2}{Frightened 1}

\Action[auditory, concentrate]{CRB}{247}{1}{Demoralize}

\CheckRoll{Intimidation}{cha, prof, -4}[Will DC]
\EffectBox{Frightened 2}{Frightened 1}

\end{document}
